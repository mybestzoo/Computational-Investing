__author__ = 't.bagramyan'

def simulate( dt_start, dt_end, ls_symbols, alloc) :
 #skip 16 hours to close time
 dt_timeofday = dt.timedelta(hours=16)
 #timestamps for closeof every trading day
 ldt_timestamps = du.getNYSEdays(dt_start, dt_end, dt_timeofday)
 #read data
 c_dataobj = da.DataAccess('Yahoo')
 ldf_data = c_dataobj.get_data(ldt_timestamps, ls_symbols, ['close'])
 d_data = dict(zip(['close'], ldf_data))

 portfolio = np.dot(d_data['close'].values, alloc)

 plt.clf()
 plt.plot(ldt_timestamps, portfolio)
 plt.legend('Portfolio')
 plt.ylabel('Adjusted Close')
 plt.xlabel('Date')
 plt.savefig('adjustedclose.pdf', format='pdf')

 print len(portfolio)
 return;

import QSTK.qstkutil.qsdateutil as du
import QSTK.qstkutil.tsutil as tsu
import QSTK.qstkutil.DataAccess as da

import datetime as dt
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np

simulate (dt.datetime(2011,1,1),dt.datetime(2011,12,31),["GOOG", "AAPL", "GLD", "XOM"],[0.2,0.3,0.4,0.1])
